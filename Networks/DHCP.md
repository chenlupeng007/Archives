### DHCP 协议
首先, 它是一种应用层协议, 建立在 UDP 协议之上, 所以整个数据包是这样的:

<Center>
  <img src='http://www.ruanyifeng.com/blogimg/asset/201206/bg2012061102.png' />
  <br />
  <br />
</Center>

这个协议规定, 每一个子网络中, 有一台计算机负责管理本网络的所有 IP 地址, 称为 DHCP 服务器. 新的计算机加入网络, 向 DHCP 服务器发送一个 DHCP 请求数据包, 申请 IP 地址和相关的网络参数. 这是位于同一个子网下的两台计算机之间的通信, 这又必须知道 DHCP 服务器的 MAC 地址和 IP 地址，才能发送数据包. 但是, 新加入的计算机不知道这两个地址, 怎么发送数据包呢?

DHCP 协议在以太网表头, 设置本方的 MAC 地址, DHCP 服务器的 MAC 地址不知道, 则设置成广播地址 FF-FF-FF-FF-FF-FF.

在 IP 表头要设置发出方的 IP 地址和接收方的 IP 地址. 这时, 对于这两者, 本机都不知道. 发出方的 IP 地址就设为 0.0.0.0, 接收方的 IP 地址设为 255.255.255.255.

最后的 UDP标头, 需要设置发出方的端口和接收方的端口. 这一部分是 DHC P协议规定好的, 发出方是 68 端口, 接收方是 67 端口.

这个数据包构造完成后由以太网广播发送, 同一个子网络的每台计算机都会收到了这个包. 因为接收方的 MAC 是广播地址 FF-FF-FF-FF-FF-FF, 看不出是发给谁的, 所以每台收到这个包的计算机, 还必须分析这个包的 IP 地址, 才能确定是不是发给自己的. 当看到发出方 IP 地址是 0.0.0.0, 接收方是 255.255.255.255, 于是 DHCP 服务器知道"这个包是发给我的", 而其他计算机就可以丢弃这个包.

接下来, DHCP 服务器读出这个包的数据内容, 分配好 IP 地址, 仍然以广播的方式经由以太网发送回去一个 DHCP 响应数据包. 这个响应包的结构也是类似的, 以太网标头的 MAC 地址是双方的网卡地址, IP 标头的 IP 地址是 DHCP 服务器的 IP 地址(发出方)和 255.255.255.255(接收方), UDP 标头的端口是 67(发出方) 和 68 (接收方), 分配给请求端的 IP 地址和本网络的具体参数则包含在 Data 部分.

子网中的计算机根据 MAC 地址可以判断出这个包. 新加入的计算机收到这个响应包, 于是就知道了自己的 IP 地址, 子网掩码, 网关地址, DNS 服务器等等参数.
